;Message File - Unit Test for DoorControl
;Course and Semester : 18649 Fall 2013
;Group 16 : Jiangtian Nie(jnie), Sally Stevenson(ststeven)
;			Yue Chen(yuechen), Sri Harsha Koppaka(skoppaka)
;Author : YueChen (yuechen)

;Note:  Assertions must be inserted more than two periods after a message or physical
;value has been inserted to be sure that the change propagates through the system

;this test file demonstrates network and framework message injections
;and network, framework, and controller state assertions.

#INCLUDE defines.mf ;include CAN id and period definitions

;intialize

;check that the door is closing initially
0.04s  A F DoorMotor FRONT LEFT : command == NUDGE
0.04s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == NUDGE

;set conditions for T5.4
0.08s  I  0s N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
0.08s  I  0s N DESIRED_FLOOR_CAN_ID DesiredFloor = 2 FRONT DOWN

;T5.4
;check that the door is closed
0.3s  A S DoorControl[FRONT][LEFT] : STATE == STATE_STOP_CLOSING
0.3s  A F DoorMotor FRONT LEFT : command == STOP
0.3s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == STOP

;set conditions for T5.5
0.34s  I  0s N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT DOWN
0.34s  I  0s N AT_FLOOR_[4][FRONT]_CAN_ID AtFloor 4 FRONT = true
0.34s  I  0s N DRIVE_SPEED_CAN_ID DriveSpeed = STOP STOP
0.34s  I  0s N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false

;T5.5
;check that the door is opening
0.48s  A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN
0.48s  A F DoorMotor FRONT LEFT : command == OPEN
0.48s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == OPEN

;set conditions for T5.1
0.50s  I  0s N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true

;T5.1
;check that the door is open
0.94s  A S DoorControl[FRONT][LEFT] : STATE == STATE_STOP_OPENING
0.94s  A F DoorMotor FRONT LEFT : command == STOP
0.94s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == STOP

;check that the door is closing 0.5s later
1.46s  A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSE
1.46s  A F DoorMotor FRONT LEFT : command == NUDGE
1.46s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == NUDGE

;clear DoorOpened
1.47s  I  0s N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false

;set conditions for T5.3
2.41s  I  0s N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = true

;T5.3
;check that door is opening
2.61s  A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN
2.61s  A F DoorMotor FRONT LEFT : command == OPEN
2.61s  A N DOOR_MOTOR_COMMAND_[FRONT][LEFT]_CAN_ID DoorMotorCommand FRONT LEFT : getDoorCommand == OPEN

